---
import videoIntro from "../assets/intro.mp4";
---

<div id="video-intro-overlay" class="video-intro-overlay">
  <video
    id="video-intro"
    class="video-intro"
    autoplay
    muted
    playsinline
  >
    <source src={videoIntro} type="video/mp4" />
  </video>
</div>

<script>
  // Check if video has been shown in this session
  const hasSeenVideo = sessionStorage.getItem("introVideoShown");
  const videoOverlay = document.getElementById("video-intro-overlay");
  const video = document.getElementById("video-intro") as HTMLVideoElement;

  if (hasSeenVideo) {
    // Hide overlay immediately if already shown this session
    if (videoOverlay) {
      videoOverlay.style.display = "none";
    }
  } else {
    // Mark that we've shown the video this session
    sessionStorage.setItem("introVideoShown", "true");

    // Handle video end
    if (video) {
      video.addEventListener("ended", () => {
        if (videoOverlay) {
          videoOverlay.classList.add("fade-out");
          // Remove overlay after fade animation completes
          setTimeout(() => {
            videoOverlay.style.display = "none";
          }, 1000);
        }
      });

      // Fallback: fade out after 30 seconds if video doesn't end properly
      setTimeout(() => {
        if (videoOverlay && !videoOverlay.classList.contains("fade-out")) {
          videoOverlay.classList.add("fade-out");
          setTimeout(() => {
            videoOverlay.style.display = "none";
          }, 1000);
        }
      }, 30000);
    }
  }
</script>

<style>
  .video-intro-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: #000;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
  }

  .video-intro {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .video-intro-overlay.fade-out {
    animation: fadeOutOverlay 1s ease-out forwards;
  }

  @keyframes fadeOutOverlay {
    from {
      opacity: 1;
    }
    to {
      opacity: 0;
    }
  }
</style>
