---
import AnimatedSection from "../AnimatedSection.astro";

interface ExperienceItem {
  company: string;
  title: string;
  date: string;
  url: string;
}

let timelineItems: ExperienceItem[] = [];

try {
  const response = await fetch("https://meezaand.github.io/config/config.json");
  if (response.ok) {
    const data = await response.json();
    timelineItems = data.experience || [];
  }
} catch (error) {
  console.error("Error fetching experience data:", error);
  timelineItems = [
    {
      company: "Flash Components CC",
      title: "Web Developer",
      date: "December 2024 - Present",
      url: "https://flash.za.com/",
    },
  ];
}

// Sort in descending order (most recent first)
timelineItems.sort((a, b) => {
  const dateA = new Date(a.date.split(" - ")[0]);
  const dateB = new Date(b.date.split(" - ")[0]);
  return dateB.getTime() - dateA.getTime();
});
---

<section class="section-padding">
  <div class="container-site max-w-6xl mx-auto px-6">
    <AnimatedSection className="text-center mb-20">
      <p
        class="text-[10px] md:text-xs tracking-[0.3em] uppercase mb-6 font-semibold"
        style="color: #001489;"
      >
        Career Journey
      </p>
      <h2 class="font-display text-4xl md:text-5xl lg:text-6xl">
        The path so far<span style="color: #001489;">.</span>
      </h2>
    </AnimatedSection>

    <div class="max-w-5xl mx-auto">
      <div class="relative">
        <!-- Vertical Timeline Line -->
        <div
          class="timeline-line absolute left-0 md:left-1/3 top-0 bottom-0 w-0.5 bg-foreground/10"
        >
        </div>

        <div class="space-y-16 md:space-y-20">
          {
            timelineItems.map((item, index) => (
              <AnimatedSection
                delay={index * 150}
                className="timeline-item relative flex flex-col md:flex-row items-start"
              >
                {/* Timeline Dot */}
                <div
                  class="timeline-dot absolute left-0 md:left-1/3 w-3 h-3 bg-primary rounded-full -ml-1.25 z-10 border-[3px] border-background"
                  style="background-color: #001489;"
                />

                {/* Date (left side on desktop, top on mobile) */}
                <div class="timeline-date w-full md:w-1/3 md:pr-12 px-5 mb-4 md:mb-0">
                  <p class="text-foreground/40 font-display text-lg md:text-xl font-semibold md:text-right">
                    {item.date}
                  </p>
                </div>

                {/* Content (right side) */}
                <div class="timeline-card w-full md:w-2/3 md:pl-12 ml-8 md:ml-0">
                  <a
                    href={item.url}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="block group"
                  >
                    <h3 class="font-display text-2xl md:text-3xl mb-3 group-hover:text-primary transition-colors">
                      {item.title}
                    </h3>
                    <p class="text-foreground/70 font-medium text-base md:text-lg flex items-center gap-2 group-hover:text-foreground transition-colors">
                      {item.company}
                      <svg
                        class="w-4 h-4 opacity-0 group-hover:opacity-100 transition-opacity"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
                        />
                      </svg>
                    </p>
                  </a>
                </div>
              </AnimatedSection>
            ))
          }
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .timeline-line {
    animation: growLine 1.5s cubic-bezier(0.25, 0.1, 0.25, 1) forwards;
    transform-origin: top;
    transform: scaleY(0);
  }

  @keyframes growLine {
    to {
      transform: scaleY(1);
    }
  }

  .timeline-item.in-view .timeline-dot {
    animation: popIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    transform: scale(0);
  }

  .timeline-item.in-view .timeline-date {
    animation: fadeInLeft 0.6s cubic-bezier(0.25, 0.1, 0.25, 1) 0.2s forwards;
    opacity: 0;
  }

  .timeline-item.in-view .timeline-card {
    animation: slideInRight 0.6s cubic-bezier(0.25, 0.1, 0.25, 1) 0.3s forwards;
    opacity: 0;
  }

  @keyframes popIn {
    to {
      transform: scale(1);
    }
  }

  @keyframes fadeInLeft {
    from {
      opacity: 0;
      transform: translateX(20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  @keyframes slideInRight {
    from {
      opacity: 0;
      transform: translateX(-30px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  /* Hover effect on date */
  .timeline-item:hover .timeline-date p {
    color: rgb(var(--foreground) / 0.6);
    transition: color 0.3s ease;
  }
</style>
